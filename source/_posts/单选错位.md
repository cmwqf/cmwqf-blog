---
title: 单选错位
date: 2019-01-28 09:23:33
tags: [概率期望]
---

[单选错位](https://www.luogu.org/problemnew/show/P1297)

我们考虑对于第i题和第i-1题，一共有a[i]*a[i-1]种可能性，显然，其中，ans[i]==ans[i-1]的可能情况有min(a[i],a[i-1])种。

所以，对于每一题i，它对答案的贡献为
$$
\frac{min(a[i],a[i-1])}{a[i]*a[i-1]}
$$
化简可得
$$
\frac{1}{max(a[i],a[i-1])}
$$
有期望的线性，直接相加即可。

```c++
#include<cstdio>
#include<algorithm> 
using namespace std;
const int maxN=1e7 + 100;
int a[maxN+1],n,A,B,C;
double ans;
int main()
{
	scanf("%d%d%d%d%d",&n,&A,&B,&C,a+1);
	for (int i=2;i<=n;i++)
	a[i] = ((long long)a[i-1] * A + B) % 100000001;
	for (int i=1;i<=n;i++)
	a[i] = a[i] % C + 1;
	ans=(double)1/max(a[1],a[n]);
	for(int i=2;i<=n;i++) ans+=(double)1/max(a[i],a[i-1]);
	printf("%.3lf",ans);
	return 0;
}
```

