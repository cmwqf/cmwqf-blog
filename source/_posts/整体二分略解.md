---
title: 整体二分略解
date: 2019-09-13 16:31:39
tags: [整体二分]
categories: [学习笔记]
---

# 整体二分

什么是整体二分？

如果你有一个操作序列（包括修改和查询），每次询问可以通过二分来解决，但是如果每次都二分的话时间复杂度就爆掉了，这个时候，也许就能使用——整体二分。

<!--more-->

# 步骤

整体二分的函数一般都写成：

```c++
inline void solve(int l, int r, int x, int y)
```

其中，$$l,r$$是答案区间，而$$x,y$$是操作区间。其中的含义就是操作$$[x,y]$$中询问的答案或修改的数的权值都在$$[l,r]$$之间。这个时候，有人会问了：你怎么知道答案或修改的值属于$$[l,r]$$的操作都是连续的呢？这个，我们后面再解决。

先考虑怎么分治：

像普通二分一样，先计算出$$mid=(l+r)>>1$$，然后，对于修改操作，按照$$<=mid$$或$$>mid$$分成左右两边，如果修改的数$$<=mid$$，就在树状数组上加以修改，这个主要是为了询问的分类做准备。对于询问操作，先通过树状数组计算出现在的贡献$$tmp$$。如果$$tmp>=num$$（$$num$$指需要的权值），就分为左边一组，否则，就让询问的权值$$num$$减掉$$tmp$$，再分到右边那一组。

最后把分类的结果$$copy$$到原来的数组中即可。

经过这么一通分类操作，就可以保证$$[l,r]$$之间的操作是连续的了。

接下来，我们就递归

```c++
solve(l, mid, x, x + t1 - 1); solve(mid + 1, r, x + t1, r);
//t1:分类到左边的操作的个数
```

其实过程很像$$cdq$$分治，但是$$cdq$$分治是在操作之前递归，然后统计前面区间对后面区间的贡献，本质上还是区别挺大的，但是写法上却差不多。。。

边界条件？

```c++
if(l > r || x > y) return;
if(l == r)
{
    for(int i = x; i <= y; i++) ans[ q[i].id ] = l;
    return;
}
```

完结撒花。

# 例题

搜索标签即可。