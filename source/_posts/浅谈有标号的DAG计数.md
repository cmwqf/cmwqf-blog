---
title: 浅谈有标号的DAG计数
date: 2021-01-01 19:41:55
tags: [dp, 容斥原理, 多项式]
categories: [学习笔记]
---

# Description

求$$n$$个点的有标号有向无环图个数，$$n\le 5000$$。

# Solution

设$$f_n$$表示$$n$$个点的$$DAG$$个数，那么有以下递推式成立：
$$
f_n=\sum_{i=1}^n(-1)^{i+1}\binom{n}{i}2^{i(n-i)}f_{n-i}
$$
为什么这个式子成立呢？

<!--more-->

考虑$$DAG$$的判定是进行拓扑排序，使得每一轮都能找到有入度为$$0$$的点。我们可以根据这个思想进行递推。

对于一个$$DAG$$，一定有至少$$1$$个入度为$$0$$的点，那么我们枚举钦定有$$i$$个点入度为$$0$$，先从$$n$$个里面选出$$i$$个，那么剩下的$$n-i$$个点为$$DAG$$，然后这$$i$$个点和剩下$$n-i$$个点之间随便连边，即$$2^{i(n-i)}$$。但是，剩下的$$n-i$$个点中也有可能出现入度为$$0$$的点，因此我们需要容斥（容斥系数可以根据二项式反演推导）。

时间复杂度$$O(n^2)$$。

# Bonus

求$$n$$个点的$$DAG$$个数，对$$998244353$$取模，$$n\le 10^5$$。

# Solution

考虑把递推式写为卷积形式，但是注意到$$2^{i(n-i)}$$不太能拆。这个时候，由类似$$Z$$变换的经典套路，因为
$$
ix=\frac{1}{2}((i+x)^2-i^2-x^2)
$$
因此
$$
2^{i(n-i)}=2^{\frac{1}{2}(n^2-i^2-(n-i)^2)}
$$
由于模$$998244353$$意义下存在$$2$$的二次剩余，即存在$$w$$使得$$w^2\equiv 2\pmod{998244353}$$，因此递推式可以转化为
$$
f_n=\sum_{i=1}^n(-1)^{i+1}\frac{n!}{i!(n-i)!}w^{n^2-i^2-(n-i)^2}f_{n-i}
$$
记
$$
F(x)=\sum_{i\ge 0} \frac{f_i}{i!w^i}x^i\\
G(x)=\sum_{i\ge 1}\frac{(-1)^{i+1}}{i!w^i}x^i
$$
那么根据递推式，有
$$
F(x)=F(x)G(x)+1\\
F(x)=\frac{1}{1-G(x)}
$$
直接多项式求逆即可，时间复杂度$$O(n\log n)$$。

