---
title: 浅谈BEST定理
date: 2020-09-12 10:10:48
tags: [图论]
categories: [学习笔记]
---

# BEST定理

什么是$$BEST$$定理呢？

所谓$$BEST$$，是由发现这个定理的四个人缩写构成的。这个定理的作用，是求有向图欧拉回路的个数。

<!--more-->

# 描述

首先，如果存在某个点的入度和出度不相等，那么这张图不存在欧拉回路。

否则，我们设$$T(x)$$表示以$$x$$为根的内向树个数，$$deg(x)$$为$$x$$的出度（等于入度），那么有向图欧拉回路个数为
$$
ans=T(rt)\prod_{v\in V}(deg(v)-1)!
$$
其中，$$rt\in V$$，也就是说，以任何一个点作为根最后都可以得出一样的答案。

但是，如果规定欧拉回路起点的话答案有所不同，这个我们后面再说。

# 证明

我们来考虑一个内向树与一个欧拉回路的对应关系。

内向树中除了根节点$$rt$$，都有一个指向父亲的边，我们把它看成从这个点出发的最后一条边。另外，我们把每个点除了指向父亲的边以外的所有边按照一定顺序排序（随便什么顺序），特别地，对于根节点，因为我们统计的是欧拉回路，是一个环，因此为了避免算重，我们钦定根节点第一个出去的边是与根节点连接的编号最小的那条边，并对与根节点相连的剩下的边按照一定顺序排序。

现在我们来证明这个与一条欧拉回路一一对应。

首先考虑确定了内向树和每个点的出边顺序后能唯一对应一条欧拉回路。

我们从根节点开始，按照确定的出边顺序走，即如果我们到了一个节点$$u$$，那么我们现在会走按照已经确定的$$u$$的出边顺序还没走过的顺序最小的边。显然，最后会回到根节点，**因为如果一个点走了内向树上连向父亲的那条边，那么说明这个点所有其他出边和入边都被走完了，反过来，对于任何一个不是根节点的节点，只要能到达这个节点，它与父亲的连边一定没有走过**，因此不会成为终点。

那么我们走出了一条回路，那么这是不是欧拉回路呢？会不会有的边没有走到呢？

假设$$u$$的某条出边或入边没有被走，那么它与父亲的连边一定不会被走，它父亲与它父亲的父亲的连边也不会走……这样，从$$u$$到根节点这条链上的所有边都不会被走，也就是说根节点有一条入边没被走，根据入度等于出度，根节点有一条出边没被走，此时根节点不会成为路径的终点，矛盾。

下面我们来证明一条欧拉路径能反过来唯一对应。

考虑每个点（除了根节点）走出的最后一条边设为内向树上这个节点与父亲的连边。我们把所有树边拿出来，每个点只有一条出边，因此我们只需证明由这些树边组成的图中没有环即可。

这个很显然，如果有环，那么因为根节点没有选边，因此根节点不可能出现在环上。那么对于环上任意一点，我们走了它的树边以后还能回到这个点，根据入度等于出度，一定还有一条边没被走，那么显然这不符合“这条树边是最后一条出边”的定义，矛盾。

那么，我们就证明了对应关系。

 内向树的方案数是$$T(rt)$$，而我们要对每个点（包括根节点）的其他出边选一个顺序，是$$\prod (deg(v)-1)!$$，那么
$$
ans=T(rt)\prod_{v\in V}(deg(v)-1)!
$$

# 注意

如果答案要求以某个点$$s$$为出发点的欧拉回路个数，那么答案是
$$
ans=T(s)deg(s)\prod_{v\in V}(deg(v)-1)!
$$
为什么呢？因为这个时候相当于将一条欧拉回路从$$s$$处断环成链，那么一条欧拉回路有$$deg(s)$$处可以断开，因此要在答案上乘以$$deg(s)$$。

另外，这个算法中，重边看作不同的边，因此如果重边看作相同的边，还要除以重边的排列数。