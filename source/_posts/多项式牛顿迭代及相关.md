---
title: 多项式牛顿迭代及相关
date: 2020-01-15 11:36:55
tags: [多项式,生成函数]
categories: [学习笔记]
---

# 泰勒公式

**多项式牛顿迭代**是很多多项式有关算法的基础，而要了解**多项式牛顿迭代**，首先要知道泰勒展开公式。

泰勒公式定义如下：

如果$$f(x)$$在某个包含$$x_0$$的闭区间$$[a,b]$$存在$$n$$阶导数，且在开区间$$(a,b)$$上存在$$n+1$$阶导数，则对于$$[a,b]$$中任意一点$$x$$，有如下式子成立
$$
f(x)=\frac{f(x_0)}{0!}+\frac{f'(x_0)}{1!}(x-x_0)+...+\frac{f^{n}(x_0)}{n!}(x-x_0)^n+R_n(x)
$$
这个$$R_n(x)$$指的是一个余项。

<!--more-->

这个公式怎么证明，我也不太会，总之，记住就好了。

那么，这个泰勒公式和**多项式牛顿迭代**有什么关系呢？

# 多项式牛顿迭代

多项式牛顿迭代指的是：

我们知道$$G(x)$$的表达式，要求解$$G(F(x)) \equiv 0\pmod {x^n}$$。

换句话说，我们已知$$G(x)$$，$$G(F(x)) \equiv 0\pmod{x^n}$$，我们要求$$F(x)$$在$$\bmod x^n$$下的表达式。

类似多项式求逆的思想，

我们假设已知$$F_0(x)$$满足$$G(F_0(x))\equiv 0\pmod {x^{\frac{n}{2}}}$$。

**注意，这里简写的$$\frac{n}{2}$$实际上是上取整，即$$\lceil \frac{n}{2}\rceil$$，以下所有的$$\frac{n}{2}$$均指上取整。**

我们考虑$$G(F(x))$$在$$F_0(x)$$处的泰勒展开：
$$
G(F(x))\equiv G(F_0(x))+\frac{G'(F_0(x))}{1!}(F(x)-F_0(x))\\+\frac{G''(F_0(x))}{2!}(F(x)-F_0(x))^2+...\pmod{x^n}
$$
我们观察$$(F(x)-F_0(x))^2$$，由定义可知，$$F(x)$$和$$F_0(x)$$前$$\frac{n}{2}-1$$项是相同的，那么$$F(x)-F_0(x)$$第一个非零之处是第$$\frac{n}{2}$$项，而平方一下就是第$$n$$项（因为上取整，所以也有可能是第$$n+1$$项），此时我们发现，因为是在$$\bmod x^n$$意义下进行，所以这一项是没有用的。也就是说，在二阶导及其后面的所有项在$$\bmod x^n$$下都是$$0$$，可以直接省略！

那么，式子就变成了
$$
G(F(x))\equiv G(F_0(x))+G'(F_0(x))(F(x)-F_0(x))\pmod{x^n}
$$
而我们知道$$G(F(x))\equiv 0\pmod{x^n}$$，所以我们有
$$
F(x)\equiv F_0(x)-\frac{G(F_0(x))}{G'(F_0(x))}\pmod{x^n}
$$
这个，就是多项式牛顿迭代的式子。

**值得注意的是，因为我们考虑的是$$G(F(x))$$在$$F_0(x)$$处的泰勒展开，整个过程相当于用$$F(x)$$代替了$$x$$，因此，我们在求导时，把$$F(x)$$看成变量而不是一个函数，而与$$F(x)$$无关的量不管是不是一个多项式都看成一个常数，这一点会在后面的$$exp$$中得到体现。**

然而，求解这个东西也需要前置知识，下面，我们先讲一些基础。

# 多项式求逆

什么是多项式求逆？

类似求整数逆元，有的时候，我们要求已知$$A(x)$$，我们要求$$B(x)$$，满足$$B(x)A(x)\equiv 1\pmod{x^n}$$，

我们假设我们已经知道$$B_0(x)A(x)\equiv 1\pmod{x^{\frac{n}{2}}}$$，同样地，这里也是上取整。

下面，我们来推式子：
$$
B_0(x)A(x)-1\equiv 0\pmod{x^{\frac{n}{2}}}\\
B_0^2(x)A^2(x)-2B_0(x)A(x)+1\equiv 0\pmod{x^{n}}
$$
注意到$$B(x)A(x)\equiv 1\pmod{x^n}$$，
$$
B_0^2(x)A^2(x)-2B_0(x)A(x)+B(x)A(x)\equiv 0\pmod{x^n}\\
B_0^2(x)A(x)-2B_0(x)+B(x)\equiv 0\pmod{x^n}\\
B(x)\equiv B_0(x)(2-A(x)B_0(x))\pmod{x^n}
$$
就这样一直迭代，每次用一下$$NTT$$，就好了。

复杂度$$O(nlog_2n)$$。

证明？

考虑每一次迭代长度为$$deg$$，那么复杂度为$$deglog_2deg$$

总的复杂度为
$$
\sum deglog_2deg
$$
我们把$$log_2deg$$看得大一点，都看成$$log_2n$$

那么式子就变为
$$
log_2n*\sum deg
$$
后面那项相当于$$n+n/2+n/4+...=2n$$，所以复杂度为$$O(nlog_2n)$$

# 多项式求导

因为$$(x^n)'=nx^{n-1}$$

所以

```c++
for(int i = 1; i <= n; i++) a[i - 1] = i * a[i];
```

# 多项式积分

因为$$\int x^n=\frac{1}{n+1}x^{n+1}$$

所以

```c++
for(int i = n - 1; i >= 0; i--) a[i + 1] = a[i] * inv[i + 1];
```

但是注意，我们无法知道常数项。

# 多项式求ln

给定多项式$$A(x)$$，我们现在要求$$B(x)\equiv ln(A(x))\pmod{x^n}$$。

怎么求呢？

我们先推式子
$$
B'(x)\equiv \frac{1}{A(x)}*A'(x)\pmod{x^n}\\
B'(x)\equiv \frac{A'(x)}{A(x)}\pmod{x^n}
$$
那么，我们将$$A(x)$$求导，再求逆，然后两个乘起来就得到了$$\frac{A'(x)}{A(x)}$$，也就是$$G'(x)$$，然后由于
$$
B(x)\equiv \int B'(x)
$$
所以最后再求个积分即可。

但是，我们这样会丢失常数项，所以常数项我们要手算，一般题目会给定$$a_0=1$$，因为这样$$ln1=0$$比较好算。

这个贴代码太影响观看体验了，就不贴代码了吧。

# 多项式exp

一般来说，题目中要对生成函数进行什么操作，都是$$ln$$和$$exp$$复合再一起的，所以一般$$ln$$和$$exp$$放在一起用。

什么是多项式$$exp$$？

给定多项式$$A(x)$$，求$$B(x)\equiv e^{A(x)}\pmod{x^n}$$。

这个时候，多项式牛顿迭代就派上用场了。

考虑到$$e$$非常不好处理，我们两边取$$ln$$
$$
ln(B(x))\equiv A(x)\pmod{x^n}\\
ln(B(x))-A(x)\equiv 0\pmod{x^n}
$$
那么，我们设$$G(x)=ln(x)-A(x)$$，$$F(x)=B(x)$$，那么我们就满足
$$
G(F(x))\equiv 0\pmod{x^n}
$$
且$$G(x)$$已知。

那么，我们就按照多项式牛顿迭代
$$
F(x)\equiv F_0(x)-\frac{G(F_0(x))}{G'(F_0(x))}\pmod{x^n}
$$

下面，我们来看$$G'(F_0(x))$$是什么？

**注意，这里的求导是对$$F_0(x)$$求导而不是对$$x$$求导，因此，式子中的$$F_0(x)$$被看成变量，而不是函数，而$$A(x)$$则被看成常数。**

因此，
$$
G'(F_0(x))=\frac{1}{F_0(x)}
$$
所以
$$
F(x)\equiv F_0(x)(1-ln(F_0(x))+A(x))
$$

# 多项式开方

当然，你可以选择$$ln$$之后$$exp$$，但是实际上牛顿迭代就可以解决。

给定$$A(x)$$，我们要求$$B(x)\equiv \sqrt{A(x)}\pmod{x^n}$$。

首先转化为牛顿迭代形式$$B^2(x)-A(x)\equiv 0\pmod{x^n}$$。

令$$F(x)=B(x)$$，$$G(F(x))=F^2(x)-A(x)$$。

那么
$$
G'(F_0(x))=2F_0(x)
$$
根据牛顿迭代
$$
F(x)\equiv F_0(x)-\frac{G(F_0(x))}{G'(F_0(x))}\pmod{x^n}\\
F(x)\equiv F_0(x)-\frac{F_0^2(x)-A(x)}{2F_0(x)}\pmod{x^n}\\
F(x)\equiv \frac{1}{2}(F_0(x)+\frac{A(x)}{F_0(x)})\pmod{x^n}
$$
然后直接多项式求逆牛顿迭代即可。

注意，不管怎么牛顿迭代（包括这里我们在牛顿迭代求开方的时候还要牛顿迭代求$$ln$$）时间复杂度都是$$O(nlog_2n)$$。

因为都是$$T(n)=T(\frac{n}{2})+O(nlog_2n)$$。

# 多项式快速幂

给定$$A(x),k$$，求$$B(x)\equiv A^k(x)\pmod{x^n}$$

这个不用多说，先取$$ln$$，乘以$$k$$，然后$$exp$$。