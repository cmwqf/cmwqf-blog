---
title: '[BZOJ3028]食物'
date: 2019-07-24 22:23:49
tags: [生成函数,组合数学]
categories: [BZOJ]
---

# Description

要带n个物品，要求：

汉堡：偶数个；可乐：0/1个；鸡腿：0/1/2个；蜜桃：奇数个；

鸡块：4的倍数个；包子0/1/2/3个；土豆：0/1个；面包：3的倍数个。

求所有情况的方案数，对10007取模。

**注意：**$$1<=n<=10^{500}$$

<!--more-->

# Solution

考虑生成函数。

我们对每一种情况搞一个生成函数，其中$$x^i$$指选i个，前面的系数就是选$$i$$个的方案数。最后，将它们乘起来，取第$$n$$项的系数就好了。

还是不清楚？继续往下看：

对于第一个汉堡，只有偶数个才会有贡献，所以它的生成函数是
$$
1+x^2+x^4+...=\frac{1}{1-x^2}
$$
第二个可乐，只要0/1个，所以它的生成函数是
$$
1+x
$$
同理，后面的也一样，我们把所有的合在一起，分别是：
$$
\frac{1}{1-x^2}\\
1+x\\
1+x+x^2\\
x+x^3+x^5+...=\frac{x}{1-x^2}\\
1+x^4+x^8+...=\frac{1}{1-x^4}\\
1+x+x^2+x^3\\
1+x\\
1+x^3+x^6+...=\frac{1}{1-x^3}
$$
他们乘起来，等于
$$
\frac{x}{(1-x)^4}
$$
然后，我们要把这个式子转化为普通形式。怎么办？

原来这个式子可以写成
$$
x(1+x+x^2+...)^4
$$
前面被提出来了一个$$x$$，那么我们就要求的是后面那个东西第$$n-1$$项的系数。

我们考虑它的组合意义，其实，它就是一个生成函数，第$$n$$项的系数表示把$$n$$拆成4个数的方案数(可以拆成0）。那么，我们就可以用插板法解决系数了。

就相当于我们有n个小球，要分成3组，每组可以为空的方案数。

那么第$$n-1$$项的系数是$$C_{n-1+4-1}^3$$，即
$$
ans=C_{n+2}^3=\frac{n(n+1)(n+2)}{6}
$$
本题还有一个难点在于$$n$$很大，应该怎么读入呢？

我们可以边读入边取模，因为
$$
(a+b)\bmod p=(a\bmod p)+ (b\bmod p)
$$


# Code

```c++
#include <cstdio>
#include <cstring>
using namespace std;

const int maxN = 500 + 10, mod = 10007;

char s[maxN + 1];
int n, len;

inline int pow(int a, int x)
{
	int ans = 1;
	while(x)
	{
		if(x & 1) ans = ans * a % mod;
		a = a * a % mod;
		x >>= 1;
	}
	return ans;
}

int main()
{
	scanf("%s", s + 1);
	len = strlen(s + 1);
	for(int i = 1; i <= len; i++)
		n = (n * 10 % mod + s[i] - '0') % mod;
	int inv = pow(6, mod - 2);
	printf("%d", n * (n + 1) % mod * (n + 2) % mod * inv % mod);
	return 0;
}
```

